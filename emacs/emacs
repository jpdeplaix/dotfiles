;; Character encoding
(set-language-environment "UTF-8")

;; No menubar
(menu-bar-mode -1)

;; Column & line number
(column-number-mode t)
(line-number-mode t)

;; Colors
(global-font-lock-mode t)

;; Split files vertically by default
(setq split-height-threshold nil)
(setq split-width-threshold 0)

;; Show paren
(require 'paren)
(show-paren-mode)

(require 'package)
(package-initialize)

;; Indent style
(setq c-default-style "bsd")
(setq require-final-newline t)
(setq-default c-basic-offset 4
              tab-width 4
              indent-tabs-mode nil)

;; Whitespace mode (Eighty Column Rule)
(require 'whitespace)
(setq whitespace-style '(face empty tabs lines-tail trailing))
(global-whitespace-mode t)

;; Remove whitespaces
(add-hook 'before-save-hook 'delete-trailing-whitespace)

;; Backups
(setq backup-directory-alist `(("." . "~/.emacs.d/backups/")))
(setq backup-enable-predicate
      (lambda (name)
        (and (normal-backup-enable-predicate name)
             (not
              (let ((method (file-remote-p name 'method)))
                (when (stringp method)
                  (member method '("su" "sudo"))))))))

;; Extended files
(add-to-list 'load-path (expand-file-name "~/.emacs.d"))

;; Vala highlight
(autoload 'vala-mode "vala-mode" "Major mode for editing Vala code." t)
(add-to-list 'auto-mode-alist '("\\.vala$" . vala-mode))
(add-to-list 'auto-mode-alist '("\\.vapi$" . vala-mode))

;; Ocsigen
(add-to-list 'auto-mode-alist '("\\.eliomi?$" . tuareg-mode))

;; Haskell
(add-hook 'haskell-mode-hook 'turn-on-haskell-indent)

;; OCaml (only with a patched tuareg-mode. See:
;; https://forge.ocamlcore.org/tracker/index.php?func=detail&aid=917&group_id=43&atid=257 )
;;(setq tuareg-case-arrow-extra-indent 2)

;; OPAM
(setq opam-share
  (substring
    (shell-command-to-string "opam config var share")
    0 -1))

;; ocp-indent
(load-file (format "%s/typerex/ocp-indent/ocp-indent.el" opam-share))

;; Merlin
(add-to-list 'load-path (format "%s/emacs/site-lisp/" opam-share))
(require 'merlin)
(add-hook 'tuareg-mode-hook 'merlin-mode)
(setq merlin-use-auto-complete-mode t)
